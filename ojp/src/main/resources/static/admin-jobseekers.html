<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>All Job Seekers â€“ JobHuntPro</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
	<style>
	:root {
	  --primary: #2563eb;
	  --primary-dark: #1e40af;
	  --success: #10b981;
	  --success-dark: #047857;
	  --gradient-bg: linear-gradient(135deg, #dbeafe, #f0fdf4);
	  --glass-bg: rgba(255, 255, 255, 0.7);
	  --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
	}

	body {
	  font-family: 'Inter', sans-serif;
	  background: var(--gradient-bg);
	  padding: 2rem 1rem;
	  color: #1f2937;
	  min-height: 100vh;
	}

	h2 {
	  font-size: 2.75rem;
	  font-weight: 800;
	  text-align: center;
	  margin-bottom: 2.5rem;
	  background: linear-gradient(to right, var(--primary), var(--success));
	  -webkit-background-clip: text;
	  -webkit-text-fill-color: transparent;
	}

	/* Header/Navbar */
	header.navbar {
	  background-color: white;
	  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
	  padding: 1rem 2rem;
	  border-radius: 12px;
	  margin-bottom: 2rem;
	  display: flex;
	  justify-content: space-between;
	  align-items: center;
	  flex-wrap: wrap;
	}

	.logo {
	  font-size: 1.75rem;
	  font-weight: 700;
	  color: var(--primary);
	}

	header.navbar nav a {
	  text-decoration: none;
	  color: #374151;
	  padding: 8px 14px;
	  border-radius: 8px;
	  font-weight: 500;
	  transition: all 0.3s ease;
	}

	header.navbar nav a:hover {
	  background-color: #e0e7ff;
	  color: var(--primary-dark);
	}

	.card {
	  background: var(--glass-bg);
	  border: 1px solid rgba(255, 255, 255, 0.5);
	  backdrop-filter: blur(14px);
	  border-radius: 20px;
	  padding: 1.5rem;
	  box-shadow: var(--card-shadow);
	  transition: all 0.3s ease;
	}

	.card:hover {
	  transform: translateY(-6px);
	  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);
	}

	.resume-link {
	  display: inline-block;
	  margin-top: 0.5rem;
	  padding: 8px 16px;
	  background: linear-gradient(to right, var(--success), #22c55e);
	  color: #fff;
	  font-weight: 600;
	  border-radius: 12px;
	  text-decoration: none;
	  transition: all 0.3s ease;
	}

	.resume-link:hover {
	  background: linear-gradient(to right, var(--success-dark), #065f46);
	}

	.btn-edit {
	  margin-top: 10px;
	  font-weight: 600;
	  background: linear-gradient(to right, var(--primary), var(--primary-dark));
	  color: white;
	  border-radius: 10px;
	  padding: 8px 16px;
	  border: none;
	  transition: transform 0.2s ease, background 0.3s ease;
	}

	.btn-edit:hover {
	  transform: scale(1.03);
	  background: linear-gradient(to right, #1d4ed8, #1e3a8a);
	}

	/* Modal Styles */
	.modal-content {
	  background: rgba(255, 255, 255, 0.9);
	  backdrop-filter: blur(12px);
	  border-radius: 16px;
	  border: 1px solid rgba(229, 231, 235, 0.6);
	  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
	}

	.modal-header {
	  background: linear-gradient(to right, var(--primary), var(--primary-dark));
	  color: white;
	  border-top-left-radius: 16px;
	  border-top-right-radius: 16px;
	  padding: 1rem 1.5rem;
	}

	.modal-title {
	  font-size: 1.25rem;
	  font-weight: 700;
	}

	.form-label {
	  font-weight: 600;
	}

	.form-control {
	  border-radius: 10px;
	  border: 1px solid #d1d5db;
	  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.04);
	  transition: border 0.3s ease, box-shadow 0.3s ease;
	}

	.form-control:focus {
	  border-color: var(--primary);
	  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
	}

	.btn-success {
	  background: linear-gradient(to right, var(--success), var(--success-dark));
	  font-weight: 600;
	  padding: 8px 16px;
	  border: none;
	  border-radius: 10px;
	}

	.btn-success:hover {
	  background: linear-gradient(to right, #059669, #047857);
	}

	.btn-secondary, .btn-primary {
	  font-weight: 600;
	  padding: 8px 16px;
	  border-radius: 10px;
	  border: none;
	}

	.btn-primary {
	  background: linear-gradient(to right, var(--primary), var(--primary-dark));
	  color: white;
	}

	.btn-primary:hover {
	  background: linear-gradient(to right, #1d4ed8, #1e3a8a);
	}

	.btn-secondary:hover {
	  background-color: #f3f4f6;
	}

	/* Responsive Enhancements */
	@media (max-width: 768px) {
	  header.navbar {
	    flex-direction: column;
	    align-items: flex-start;
	  }

	  .logo {
	    margin-bottom: 0.75rem;
	  }

	  header.navbar nav {
	    gap: 0.5rem;
	  }

	  .card {
	    padding: 1.2rem;
	  }
	}
	</style>	

</head>

<body>
	<header class="navbar">
		<div class="logo">JobHuntPro</div>
		<nav class="d-flex align-items-center gap-3 flex-wrap">
			<a href="admin-index">Index</a>
			<a href="admin-dashboard">Dashboard</a>
			<a href="admin-about">About</a>
			<a href="admin-contact">Contact</a>
			<a href="admin-jobseekers">Job Seekers</a>
			<a href="admin-recruiters">Employers</a>
			<a href="admin-report">Report</a>
			<a href="admin-admins">Admins</a>
			<a href="admin-applications">Applications</a>
			<a href="admin-profile">Profile</a>
		</nav>
	</header>
	<div class="container mb-4">
		<div class="row justify-content-center">
			<div class="col-md-6 d-flex gap-2">
				<input type="number" id="searchIdInput" class="form-control" placeholder="Enter Job Seeker ID" />
				<button class="btn btn-primary" onclick="searchById()">Search</button>
				<button class="btn btn-secondary" onclick="loadJobSeekers()">Reset</button>
			</div>
		</div>
	</div>

	<h2>Registered Job Seekers</h2>

	<div class="container">
		<div class="row" id="jobSeekerList">
			<!-- Cards here -->
		</div>
	</div>

	<!-- Modal for Edit -->
	<div class="modal fade" id="editModal" tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<form id="editForm">
					<div class="modal-header">
						<h5 class="modal-title">Edit Job Seeker</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
					<div class="modal-body row g-3 px-3 py-2">
						<input type="hidden" id="editId" />
						<input type="hidden" id="userId" />

						<div class="col-md-6">
							<label class="form-label">Name</label>
							<input type="text" id="editName" class="form-control" required />
						</div>
						<div class="col-md-6">
							<label class="form-label">Email</label>
							<input type="email" id="editEmail" class="form-control" required />
						</div>
						<div class="col-md-6">
							<label class="form-label">Password</label>
							<input type="password" id="editPassword" class="form-control" required />
						</div>
						<div class="col-md-6">
							<label class="form-label">Contact</label>
							<input type="text" id="editContact" class="form-control" />
						</div>
						<div class="col-md-6">
							<label class="form-label">Skills</label>
							<input type="text" id="editSkills" class="form-control" />
						</div>
						<div class="col-md-6">
							<label class="form-label">Education</label>
							<input type="text" id="editEducation" class="form-control" />
						</div>
						<div class="col-md-6">
							<label class="form-label">Experience</label>
							<input type="text" id="editExperience" class="form-control" />
						</div>
						<div class="col-md-6">
							<label class="form-label">New Resume (optional)</label>
							<input type="file" id="editResume" class="form-control" />
						</div>
					</div>
					<div class="modal-footer">
						<button type="submit" class="btn btn-success">Update</button>
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<script>
		let selectedSeeker;

		async function loadJobSeekers() {
			const container = document.getElementById("jobSeekerList");
			container.innerHTML = `<p class="text-center">Loading...</p>`;

			try {
				const res = await fetch("http://localhost:8080/jobseeker");
				const {body: seekers} = await res.json();

				if (!seekers || seekers.length === 0) {
					container.innerHTML = `<p class="text-danger text-center">No job seekers found.</p>`;
					return;
				}

				container.innerHTML = seekers.map(seeker => {
					const {id, contact, skills, education, experience, resumeUrl, user} = seeker;

					return `
          <div class="col-md-6 col-lg-4 mb-4">
            <div class="card p-3">
              <h5><strong>Id: </strong>${id}</h5>
              <p><strong>Name:</strong> ${user?.name}</p>
              <p><strong>Email:</strong> ${user?.email}</p>
              <p><strong>Contact:</strong> ${contact}</p>
              <p><strong>Skills:</strong> ${skills}</p>
              <p><strong>Education:</strong> ${education}</p>
              <p><strong>Experience:</strong> ${experience}</p>
              <a class="resume-link" href="${resumeUrl}" target="_blank">View Resume</a>
              <button class="btn-edit mt-2" onclick='openEdit(${JSON.stringify(seeker)})'>Edit</button>
            </div>
          </div>
        `;
				}).join("");
			} catch (err) {
				console.error(err);
				container.innerHTML = `<p class="text-danger text-center">Failed to load job seekers.</p>`;
			}
		}

		async function searchById() {
			const id = document.getElementById("searchIdInput").value.trim();
			const container = document.getElementById("jobSeekerList");

			if (!id || isNaN(id)) {
				alert("Please enter a valid numeric ID.");
				return;
			}

			container.innerHTML = `<p class="text-center">Searching...</p>`;

			try {
				const res = await fetch(`http://localhost:8080/jobseeker/${id}`);
				const {body} = await res.json();

				if (!body || !body.user) {
					container.innerHTML = `<p class="text-danger text-center">Job Seeker with ID ${id} not found.</p>`;
					return;
				}

				const seeker = body;
				const {contact, skills, education, experience, resumeUrl, user} = seeker;

				container.innerHTML = `
        <div class="col-md-6 col-lg-4 mx-auto mb-4">
          <div class="card p-3">
            <h5>${user?.name}</h5>
            <p><strong>Email:</strong> ${user?.email}</p>
            <p><strong>Contact:</strong> ${contact}</p>
            <p><strong>Skills:</strong> ${skills}</p>
            <p><strong>Education:</strong> ${education}</p>
            <p><strong>Experience:</strong> ${experience}</p>
            <a class="resume-link" href="${resumeUrl}" target="_blank">View Resume</a>
            <button class="btn-edit mt-2" onclick='openEdit(${JSON.stringify(seeker)})'>Edit</button>
          </div>
        </div>
      `;
			} catch (err) {
				console.error(err);
				container.innerHTML = `<p class="text-danger text-center">Error fetching job seeker.</p>`;
			}
		}

		function openEdit(seeker) {
			selectedSeeker = seeker;
			const {id, contact, skills, education, experience, user} = seeker;

			document.getElementById("editId").value = id;
			document.getElementById("userId").value = user.id;
			document.getElementById("editName").value = user.name;
			document.getElementById("editEmail").value = user.email;
			document.getElementById("editPassword").value = user.password;
			document.getElementById("editContact").value = contact;
			document.getElementById("editSkills").value = skills;
			document.getElementById("editEducation").value = education;
			document.getElementById("editExperience").value = experience;
			document.getElementById("editResume").value = '';

			new bootstrap.Modal(document.getElementById("editModal")).show();
		}

		document.getElementById("editForm").addEventListener("submit", async function (e) {
			e.preventDefault();

			const formData = new FormData();
			const jobSeeker = {
				id: +document.getElementById("editId").value,
				contact: document.getElementById("editContact").value,
				skills: document.getElementById("editSkills").value,
				education: document.getElementById("editEducation").value,
				experience: document.getElementById("editExperience").value,
				user: {
					id: +document.getElementById("userId").value,
					name: document.getElementById("editName").value,
					email: document.getElementById("editEmail").value,
					password: document.getElementById("editPassword").value,
					role: "JOB_SEEKER"
				}
			};

			formData.append("jobSeeker", new Blob([JSON.stringify(jobSeeker)], {type: "application/json"}));

			const resumeFile = document.getElementById("editResume").files[0];
			if (resumeFile) formData.append("resume", resumeFile);

			try {
				const res = await fetch("http://localhost:8080/jobseeker/update", {
					method: "PUT",
					body: formData
				});

				const result = await res.json();
				alert(result.message || "Job Seeker updated!");
				bootstrap.Modal.getInstance(document.getElementById("editModal")).hide();
				loadJobSeekers();
			} catch (err) {
				console.error(err);
				alert("Update failed!");
			}
		});

		window.onload = loadJobSeekers;
	</script>
	<script>
	  document.getElementById("editForm").addEventListener("submit", async function (e) {
	    e.preventDefault();

	    const userId = +document.getElementById("userId").value;
	    const updatedUser = {
	      name: document.getElementById("editName").value,
	      email: document.getElementById("editEmail").value,
	      password: document.getElementById("editPassword").value,
	      role: "JOB_SEEKER"
	    };

	    try {
	      // Step 1: Update User first
	      const userRes = await fetch(`http://localhost:8080/users/update/${userId}`, {
	        method: "PUT",
	        headers: { "Content-Type": "application/json" },
	        body: JSON.stringify(updatedUser)
	      });

	      if (!userRes.ok) {
	        alert("Failed to update user.");
	        return;
	      }

	      // Step 2: Prepare JobSeeker data
	      const formData = new FormData();
	      const jobSeeker = {
	        id: +document.getElementById("editId").value,
	        contact: document.getElementById("editContact").value,
	        skills: document.getElementById("editSkills").value,
	        education: document.getElementById("editEducation").value,
	        experience: document.getElementById("editExperience").value,
	        user: { id: userId }
	      };

	      formData.append("jobSeeker", new Blob([JSON.stringify(jobSeeker)], { type: "application/json" }));

	      const resumeFile = document.getElementById("editResume").files[0];
	      if (resumeFile) formData.append("resume", resumeFile);

	      // Step 3: Update JobSeeker
	      const res = await fetch("http://localhost:8080/jobseeker/update", {
	        method: "PUT",
	        body: formData
	      });

	      const result = await res.json();
	      alert(result.message || "Job Seeker updated!");
	      bootstrap.Modal.getInstance(document.getElementById("editModal")).hide();
	      loadJobSeekers();

	    } catch (err) {
	      console.error(err);
	      alert("Update failed!");
	    }
	  });
	</script>

	
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>